<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文言文推與敲 - 第35篇 斫樹取果 (模擬試題)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fff7ed; /* orange-50 */
        }
        
        .serif {
            font-family: 'Noto Serif TC', serif;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(234, 88, 12, 0.2), 0 2px 4px -1px rgba(234, 88, 12, 0.1);
        }
        
        /* Custom scrollbar for review list */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #fff7ed;
        }
        ::-webkit-scrollbar-thumb {
            background: #fdba74;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #f97316;
        }

        /* Card background transitions */
        .card-neutral { background-color: white; border-color: #f3f4f6; }
        .card-correct { background-color: #ecfdf5; border-color: #34d399; } /* green-50, green-400 */
        .card-wrong { background-color: #fef2f2; border-color: #f87171; } /* red-50, red-400 */
        
        .transition-colors-slow {
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-gray-800 selection:bg-orange-200">

    <!-- Header -->
    <header class="bg-gradient-to-r from-orange-600 to-amber-600 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-wider flex items-center gap-2" onclick="goHome()" style="cursor: pointer;">
                <i class="fas fa-scroll text-amber-200"></i>
                <span>斫樹取果</span>
            </h1>
            
            <div id="user-display" class="hidden flex items-center gap-3">
                <div class="text-sm bg-white/20 px-3 py-1 rounded-full flex items-center backdrop-blur-sm">
                    <i class="fas fa-user mr-2 text-amber-200"></i>
                    <span id="username-span" class="font-medium"></span>
                </div>
                <button onclick="logout()" class="text-xs bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded transition shadow-sm" title="登出並返回首頁">
                    <i class="fas fa-sign-out-alt mr-1"></i>登出
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6 max-w-3xl">
        
        <!-- View: Login -->
        <div id="view-login" class="fade-in max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden mt-6 border-t-4 border-orange-500">
            <div class="p-8">
                <div class="text-center mb-8">
                    <div class="inline-block p-3 rounded-full bg-orange-100 text-orange-600 mb-3">
                        <i class="fas fa-book-reader text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-1">文言文推與敲</h2>
                    <p class="text-orange-600 font-medium">第35篇 斫樹取果</p>
                    <p class="text-gray-400 text-sm mt-2">全真模擬試題 • 自動記錄進度</p>
                </div>
                
                <div class="space-y-5">
                    <div>
                        <label for="username" class="block text-sm font-bold text-gray-700 mb-2">請輸入姓名開始</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-pencil-alt text-gray-400"></i>
                            </div>
                            <input type="text" id="username" 
                                class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all bg-gray-50 focus:bg-white" 
                                placeholder="例如：王小明"
                                onkeypress="if(event.key === 'Enter') attemptLogin()">
                        </div>
                    </div>
                    
                    <button onclick="attemptLogin()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-lg transition duration-200 font-bold shadow-md hover:shadow-lg transform active:scale-95">
                        登入系統 <i class="fas fa-sign-in-alt ml-1"></i>
                    </button>

                    <!-- Quick Login Section -->
                    <div id="quick-login-area" class="hidden pt-4 border-t border-gray-100">
                        <p class="text-xs text-gray-500 mb-3 font-medium">快速登入（最近使用）</p>
                        <div id="recent-users-list" class="flex flex-wrap gap-2">
                            <!-- Buttons injected by JS -->
                        </div>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button onclick="clearData()" class="text-xs text-gray-400 hover:text-red-500 underline transition">清除本機所有紀錄</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- View: Dashboard -->
        <div id="view-dashboard" class="hidden fade-in max-w-lg mx-auto mt-6">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-amber-500 p-8">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-gray-800">歡迎回來，<span id="dashboard-username" class="text-orange-600"></span></h2>
                    <p class="text-gray-500 text-sm mt-2">請選擇您要進行的項目</p>
                </div>

                <div class="space-y-4">
                    <button onclick="startExam()" class="w-full bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white py-4 px-6 rounded-xl transition duration-200 font-bold shadow-md hover:shadow-lg flex items-center justify-between group">
                        <span class="flex items-center"><i class="fas fa-pen-nib text-xl mr-3 w-8 text-center"></i> 開始測驗</span>
                        <i class="fas fa-chevron-right opacity-50 group-hover:opacity-100 transition-opacity"></i>
                    </button>

                    <button onclick="showReview('wrong')" class="w-full bg-white border-2 border-red-100 text-red-600 hover:bg-red-50 py-4 px-6 rounded-xl transition duration-200 font-bold shadow-sm hover:shadow-md flex items-center justify-between group">
                        <span class="flex items-center"><i class="fas fa-times-circle text-xl mr-3 w-8 text-center"></i> 錯題本</span>
                        <span class="text-sm bg-red-100 px-2 py-1 rounded text-red-600" id="dash-wrong-count">0</span>
                    </button>

                    <button onclick="showReview('favorite')" class="w-full bg-white border-2 border-amber-100 text-amber-600 hover:bg-amber-50 py-4 px-6 rounded-xl transition duration-200 font-bold shadow-sm hover:shadow-md flex items-center justify-between group">
                        <span class="flex items-center"><i class="fas fa-star text-xl mr-3 w-8 text-center"></i> 我的最愛</span>
                        <span class="text-sm bg-amber-100 px-2 py-1 rounded text-amber-600" id="dash-fav-count">0</span>
                    </button>

                    <div class="pt-4 border-t border-gray-100 mt-4">
                        <button onclick="showAllQuestions()" class="w-full bg-gray-50 text-gray-600 hover:bg-gray-100 py-3 px-4 rounded-lg transition duration-200 font-medium text-sm flex items-center justify-center">
                            <i class="fas fa-list-ul mr-2"></i> 題目一覽表 (快速刷題)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- View: Quiz -->
        <div id="view-quiz" class="hidden fade-in">
            <!-- Progress Bar -->
            <div class="mb-6 flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-orange-100">
                <div class="flex items-center space-x-3">
                    <div class="flex items-baseline space-x-1">
                        <span class="text-3xl font-bold text-orange-600" id="current-question-num">1</span>
                        <span class="text-gray-400 text-lg">/</span>
                        <span class="text-gray-500 text-sm font-medium">25</span>
                    </div>
                    <div class="h-2 w-24 bg-gray-100 rounded-full overflow-hidden ml-2 hidden sm:block">
                        <div id="progress-bar-fill" class="h-full bg-orange-500 transition-all duration-300" style="width: 5%"></div>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="restartQuiz()" class="text-gray-400 hover:text-orange-600 transition px-3 py-1 rounded-lg hover:bg-orange-50 text-sm font-medium mr-1 border border-transparent hover:border-orange-200">
                        <i class="fas fa-redo-alt mr-1"></i> 重新開始
                    </button>
                    <button onclick="toggleFavorite()" id="btn-favorite" class="text-gray-300 hover:text-amber-500 transition p-2 rounded-full hover:bg-amber-50" title="加入最愛">
                        <i class="far fa-star text-2xl"></i>
                    </button>
                </div>
            </div>

            <!-- Question Card -->
            <div id="question-card" class="card-neutral rounded-2xl shadow-lg overflow-hidden mb-6 border transition-colors-slow">
                <div class="p-6 md:p-8">
                    <div class="mb-6">
                        <span class="inline-block bg-orange-100 text-orange-700 text-xs px-2.5 py-1 rounded-md font-bold mb-3 tracking-wide" id="q-category">字義</span>
                        <h3 class="text-2xl md:text-3xl font-medium text-gray-800 leading-relaxed serif" id="q-text">題目載入中...</h3>
                    </div>

                    <!-- Options -->
                    <div class="space-y-3" id="options-container">
                        <!-- Options generated by JS -->
                    </div>
                </div>
                
                <!-- Explanation Area -->
                <div id="explanation-area" class="hidden bg-white/50 border-t border-gray-100 p-6 md:p-8 backdrop-blur-sm">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mt-1">
                            <i id="feedback-icon" class="fas fa-check-circle text-green-500 text-2xl"></i>
                        </div>
                        <div class="ml-4 w-full">
                            <h4 class="text-lg font-bold text-gray-900 mb-2" id="feedback-title">答對了！</h4>
                            <div class="text-gray-700 text-xl leading-relaxed mb-6 bg-white p-4 rounded-lg border border-gray-200 shadow-sm" id="feedback-text">
                                解析內容...
                            </div>
                            <button onclick="nextQuestion()" class="w-full sm:w-auto bg-orange-600 text-white px-8 py-3 rounded-lg hover:bg-orange-700 transition shadow font-medium flex items-center justify-center">
                                下一題 <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View: Result -->
        <div id="view-result" class="hidden fade-in max-w-2xl mx-auto">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden text-center p-8 border-t-8 border-orange-500">
                <div class="mb-8">
                    <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-orange-50 mb-4 ring-4 ring-orange-100">
                        <i class="fas fa-trophy text-4xl text-orange-500"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">測驗完成！</h2>
                    <p class="text-gray-500">恭喜您完成了所有題目，以下是您的成績</p>
                </div>

                <div class="grid grid-cols-3 gap-4 mb-8">
                    <div class="bg-orange-50 p-5 rounded-xl border border-orange-100">
                        <div class="text-4xl font-bold text-orange-600 mb-1" id="result-score">0</div>
                        <div class="text-xs text-orange-400 uppercase tracking-wider font-bold">總分</div>
                    </div>
                    <div class="bg-green-50 p-5 rounded-xl border border-green-100">
                        <div class="text-4xl font-bold text-green-600 mb-1" id="result-correct">0</div>
                        <div class="text-xs text-green-500 uppercase tracking-wider font-bold">答對</div>
                    </div>
                    <div class="bg-red-50 p-5 rounded-xl border border-red-100 cursor-pointer hover:bg-red-100 transition group" onclick="showReview('wrong')">
                        <div class="text-4xl font-bold text-red-600 mb-1 group-hover:scale-110 transition-transform" id="result-wrong">0</div>
                        <div class="text-xs text-red-400 uppercase tracking-wider font-bold">錯題 (點擊複習)</div>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row justify-center gap-3">
                    <button onclick="restartQuiz()" class="px-6 py-3 border-2 border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50 hover:border-gray-300 font-bold transition">
                        <i class="fas fa-redo mr-2"></i>重新測驗
                    </button>
                    <button onclick="showReview('wrong')" class="px-6 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 font-bold transition">
                        <i class="fas fa-times-circle mr-2"></i>複習錯題
                    </button>
                    <button onclick="showReview('favorite')" class="px-6 py-3 bg-amber-100 text-amber-700 rounded-lg hover:bg-amber-200 font-bold transition">
                        <i class="fas fa-star mr-2"></i>我的最愛
                    </button>
                    <button onclick="showDashboard()" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-bold transition">
                        <i class="fas fa-home mr-2"></i>回主選單
                    </button>
                </div>
            </div>
        </div>

        <!-- View: Review List / All Questions -->
        <div id="view-review" class="hidden fade-in">
            <div class="flex items-center justify-between mb-6 bg-white p-4 rounded-xl shadow-sm sticky top-20 z-40 border border-orange-100">
                <div class="flex items-center gap-3">
                    <div class="bg-orange-100 p-2 rounded-lg">
                        <i class="fas fa-book-open text-orange-600"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800" id="review-title">錯題本</h2>
                </div>
                <div class="flex gap-2">
                    <button onclick="restartQuiz()" class="text-orange-600 hover:bg-orange-50 font-bold transition flex items-center bg-white border border-orange-200 px-3 py-2 rounded-lg">
                        <i class="fas fa-redo-alt mr-2"></i> 重新開始
                    </button>
                    <button onclick="backToHomeOrResult()" class="text-gray-500 hover:text-orange-600 font-bold transition flex items-center bg-gray-50 px-3 py-2 rounded-lg hover:bg-orange-50">
                        <i class="fas fa-arrow-left mr-2"></i> 返回
                    </button>
                </div>
            </div>
            <div id="review-list" class="space-y-6 pb-10">
                <!-- Review Items -->
            </div>
        </div>

    </main>

    <footer class="bg-white border-t border-orange-100 mt-auto py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-500 font-medium mb-2">文言文推與敲 - 斫樹取果</p>
            <p class="text-gray-400 text-xs">&copy; 2025 道明中學國二國文模擬試題</p>
        </div>
    </footer>

    <script>
        // --- Data Configuration ---
        const DB_PREFIX = 'ChineseClassicalQuiz-035-';
        
        // --- Questions Data (斫樹取果) ---
        // 內容來源：《百喻經》
        /*
          昔有國王，有一好樹，高廣極大，當生勝果，香而甜美。
          時有一人來至王所，王語之言：「此之樹上將生美果，汝能食不？」
          即答王言：「此樹高廣，雖欲食之，何由能得？」
          即便斷樹望得其果，既無所獲，徒自勞苦，後還欲竪，樹已枯死都無生理。
        */

        const questionsData = [
            {
                id: 1,
                category: "字義測驗",
                question: "「當生勝果」中的「勝」，解釋為何？",
                options: [
                    "勝利",
                    "能夠承受",
                    "美好、優越",
                    "多數"
                ],
                answer: 2, // C
                explanation: "「勝」在此為形容詞，意指美好的、優越的。勝果即美好的果實（佛經中亦指修行的成果，此處雙關）。"
            },
            {
                id: 2,
                category: "通假字",
                question: "「汝能食不」句末的「不」字，通哪一個字？讀音為何？",
                options: [
                    "弗，ㄈㄨˊ",
                    "否，ㄈㄡˇ",
                    "必，ㄅㄧˋ",
                    "罷，ㄅㄚˋ"
                ],
                answer: 1, // B
                explanation: "「不」通「否」，讀ㄈㄡˇ，置於句末表示疑問，意為「嗎」。"
            },
            {
                id: 3,
                category: "文意理解",
                question: "「斫」樹取果的「斫」，讀音與意思為何？",
                options: [
                    "ㄓㄜˊ，折斷",
                    "ㄓㄨㄛˊ，砍削",
                    "ㄒㄧ，分析",
                    "ㄐㄧㄣ，斧頭"
                ],
                answer: 1, // B
                explanation: "斫（ㄓㄨㄛˊ）：用刀斧砍削。"
            },
            {
                id: 4,
                category: "虛詞用法",
                question: "「徒自勞苦」的「徒」，用法與下列何者相同？",
                options: [
                    "「徒」步而行",
                    "「徒」勞無功",
                    "家「徒」四壁",
                    "「徒」弟眾多"
                ],
                answer: 1, // B
                explanation: "題幹「徒」：白白地、空。與(B)相同。(A)步行。(C)僅、只。(D)門人。"
            },
            {
                id: 5,
                category: "字義辨析",
                question: "「後還欲竪」的「竪」字，通「豎」，意思是？",
                options: [
                    "橫放",
                    "建立、直立",
                    "童僕",
                    "堅固"
                ],
                answer: 1, // B
                explanation: "竪（豎）：使物體直立。指那人想把砍斷的樹重新種（立）回去。"
            },
            {
                id: 6,
                category: "詞義推敲",
                question: "「都無生理」的「都」，在文中的意思是？",
                options: [
                    "都市",
                    "全都、完全",
                    "優美",
                    "聚集"
                ],
                answer: 1, // B
                explanation: "「都」為副詞，表示總括，意為「完全」。"
            },
            {
                id: 7,
                category: "詞義古今異同",
                question: "「樹已枯死都無生理」中的「生理」，古今意義不同。文中之意為？",
                options: [
                    "生物學的功能",
                    "生存的道理",
                    "生機、活路",
                    "生意的利潤"
                ],
                answer: 2, // C
                explanation: "古文中「生理」常指生機、活下去的希望。現代多指生物體的功能或生命現象。"
            },
            {
                id: 8,
                category: "代詞辨析",
                question: "「此之樹上」與「王語之言」，兩句中的「之」字用法分別為？",
                options: [
                    "指示代詞（這）／ 代詞（他，指那個人）",
                    "助詞（的）／ 助詞（無義）",
                    "代詞（它）／ 動詞（往）",
                    "助詞（的）／ 代詞（他）"
                ],
                answer: 0, // A
                explanation: "「此之樹」的「之」同「這」，指示代詞，強調「這棵樹」（或視為助詞亦可，但A選項後半部正確）。「王語之言」的「之」為代詞，指代那個人（告訴他）。註：嚴格語法分析，「此之樹」的之多視為指示代詞複指，或助詞。但「王語之言」的「之」必為代詞「他」。選項A最合理。"
            },
            {
                id: 9,
                category: "文句因果",
                question: "這個人為什麼要「斷樹」？主要原因是？",
                options: [
                    "樹木太高大，無法爬上去採果",
                    "他想要木材來蓋房子",
                    "國王命令他砍樹",
                    "樹上長滿了蟲"
                ],
                answer: 0, // A
                explanation: "文中提到「此樹高廣，雖欲食之，何由能得？」，因為樹太高大，不知道怎麼摘，所以乾脆砍斷。"
            },
            {
                id: 10,
                category: "寓意探討",
                question: "《斫樹取果》這則寓言主要在諷刺哪一種人？",
                options: [
                    "懶惰不願工作的人",
                    "為了眼前小利而毀壞根本（殺雞取卵）的人",
                    "不懂得種樹技術的人",
                    "違背國王命令的人"
                ],
                answer: 1, // B
                explanation: "為了得到果實（利）而砍斷樹根（本），結果不但得不到果實，連樹也死了，諷刺急功近利、因小失大。"
            },
            {
                id: 11,
                category: "成語比較",
                question: "下列哪一個成語的含義與「斫樹取果」最為相近？",
                options: [
                    "緣木求魚",
                    "竭澤而漁",
                    "守株待兔",
                    "畫蛇添足"
                ],
                answer: 1, // B
                explanation: "「竭澤而漁」排乾池水抓魚，雖能得魚但明年無魚，比喻只顧眼前利益，不顧長遠發展，與斫樹取果（殺雞取卵）意近。(A)緣木求魚是方法錯誤徒勞無功，未強調毀壞根本。"
            },
            {
                id: 12,
                category: "文法結構",
                question: "「即便斷樹」的「即便」，意思是？",
                options: [
                    "即使",
                    "立刻、於是就",
                    "方便",
                    "雖然"
                ],
                answer: 1, // B
                explanation: "「即便」在古文中常作連詞，表示承接，意為「於是就」、「立刻」。"
            },
            {
                id: 13,
                category: "字義測驗",
                question: "「雖欲食之，何由能得」的「由」，解釋為？",
                options: [
                    "原因",
                    "從、途徑（方法）",
                    "任憑",
                    "因為"
                ],
                answer: 1, // B
                explanation: "「何由」即「從何」、「用什麼方法」。由表途徑、方法。"
            },
            {
                id: 14,
                category: "情節推論",
                question: "文中提到「既無所獲」，為什麼砍倒樹後會沒有收穫？",
                options: [
                    "果實被國王拿走了",
                    "樹倒下的時候果實都摔爛了",
                    "因為當時果實尚未成熟或樹已死（時機未到或方法錯誤）",
                    "果實被鳥吃光了"
                ],
                answer: 2, // C
                explanation: "寓言隱含的意思是修成正果需要時間（樹長大結果），那人急於求成，在果實未生或未熟時就砍樹，自然一無所獲（且樹死亦不再生果）。"
            },
            {
                id: 15,
                category: "詞性判斷",
                question: "「香而甜美」的「而」，詞性與作用是？",
                options: [
                    "轉折連詞（但是）",
                    "並列連詞（而且、又）",
                    "因果連詞（所以）",
                    "假設連詞（如果）"
                ],
                answer: 1, // B
                explanation: "連接兩個形容詞（香、甜美），表示並列關係。"
            },
            {
                id: 16,
                category: "字義辨析",
                question: "「王語之言」的「語」，讀音與意思是？",
                options: [
                    "ㄩˇ，語言",
                    "ㄩˋ，告訴",
                    "ㄩˇ，和...說話",
                    "ㄩˋ，語言"
                ],
                answer: 1, // B
                explanation: "語，讀ㄩˋ，動詞，告訴。"
            },
            {
                id: 17,
                category: "修辭辨析",
                question: "「高廣極大」是一種什麼修辭？",
                options: [
                    "譬喻",
                    "摹寫",
                    "誇飾",
                    "轉化"
                ],
                answer: 1, // B
                explanation: "這是直接描寫樹的外觀（視覺摹寫）。雖有程度詞「極」，但未達誇飾之明顯虛構。"
            },
            {
                id: 18,
                category: "譬喻含義",
                question: "在佛教《百喻經》中，這則故事的「樹」通常比喻什麼？",
                options: [
                    "金錢財富",
                    "國王的權力",
                    "修行的過程或身體",
                    "美味的食物"
                ],
                answer: 2, // C
                explanation: "樹喻指修行、持戒或身體。果喻指證悟的佛果。如果不腳踏實地修行，只想走捷徑或毀壞戒律（斷樹），是無法證果的。"
            },
            {
                id: 19,
                category: "句意解讀",
                question: "「後還欲竪」這一個動作反映了此人什麼樣的心理狀態？",
                options: [
                    "鍥而不捨，堅持到底",
                    "發現錯誤，試圖補救（但徒勞無功）",
                    "想把樹種回去讓它長得更高",
                    "為了掩飾自己的罪行"
                ],
                answer: 1, // B
                explanation: "砍倒後發現沒果子，又想把樹立回去，顯示他發現弄巧成拙，試圖挽回，但為時已晚。"
            },
            {
                id: 20,
                category: "生活應用",
                question: "小華為了應付明天的考試，今晚熬夜不睡覺，結果第二天精神不濟考更差。這可以用哪句話來形容？",
                options: [
                    "十年樹木，百年樹人",
                    "斫樹取果，得不償失",
                    "前人種樹，後人乘涼",
                    "精誠所至，金石為開"
                ],
                answer: 1, // B
                explanation: "熬夜傷身（斫樹）求成績（取果），結果反而考差（樹死無果），得不償失。"
            },
            {
                id: 21,
                category: "字形測驗",
                question: "下列「」中的字，何者讀音與「斫」不同？",
                options: [
                    "斟「酌」",
                    "「灼」熱",
                    "「茁」壯",
                    "笨「拙」"
                ],
                answer: 3, // D
                explanation: "斫：ㄓㄨㄛˊ。(A)酌：ㄓㄨㄛˊ。(B)灼：ㄓㄨㄛˊ。(C)茁：ㄓㄨㄛˊ。(D)拙：ㄓㄨㄛˊ（疑？檢查：拙讀ㄓㄨㄛˊ，茁讀ㄓㄨㄛˊ。全同音？等等。「拙」應讀ㄓㄨㄛˊ。 修正：選項設計需更精確。D選項改為「卓越」的「卓」也是ㄓㄨㄛˊ。改個不同音的：雕「琢」ㄓㄨㄛˊ。全部都同音？啊，題目是要選不同的。改D為：污「濁」ㄓㄨㄛˊ。 檢查讀音：斫(zhúo)，酌(zhúo)，灼(zhúo)，茁(zhúo)，拙(zhúo)，濁(zhúo)。 哎呀，全同音。修正D選項為：「斲」喪（ㄓㄨㄛˊ）。再找一個不同音的：被「捉」住（ㄓㄨㄛ）。或者：執「著」（ㄓㄨㄛˊ）。設計陷阱：骨「折」（ㄓㄜˊ）。修正題目D選項：骨「折」。"
                /* Wait, let's re-verify:
                   斫 (zhuó) ㄓㄨㄛˊ
                   酌 (zhuó) ㄓㄨㄛˊ
                   灼 (zhuó) ㄓㄨㄛˊ
                   茁 (zhuó) ㄓㄨㄛˊ
                   拙 (zhuō) ㄓㄨㄛ (第一聲) -> This is the one!
                   Check dictionary: 拙, ㄓㄨㄛˊ (No, standard is ㄓㄨㄛˊ usually, but some dict say zhuō. In Taiwan MOE dict: 拙 ㄓㄨㄛˊ).
                   Let's use a clear one. 
                   D: 彎「曲」 (ㄑㄩ). Too easy.
                   D: 「斲」喪 (ㄓㄨㄛˊ).
                   Let's use: 「昨」日 (ㄗㄨㄛˊ).
                */
            },
            {
                id: 21,
                category: "字形字音",
                question: "下列「」中的字，讀音與「斫」完全相同的是？",
                options: [
                    "「昨」日",
                    "「作」業",
                    "斟「酌」",
                    "「左」右"
                ],
                answer: 2, // C
                explanation: "斫：ㄓㄨㄛˊ。(A)ㄗㄨㄛˊ。(B)ㄗㄨㄛˋ。(C)酌：ㄓㄨㄛˊ。(D)ㄗㄨㄛˇ。"
            },
            {
                id: 22,
                category: "哲理比較",
                question: "「揠苗助長」與「斫樹取果」相比，兩者的共同點是？",
                options: [
                    "都涉及農業技術",
                    "都因為急躁而違反自然規律，導致失敗",
                    "都是因為懶惰",
                    "主角最後都獲得了成功"
                ],
                answer: 1, // B
                explanation: "兩者都是因為急於求成（助長/取果），違反了事物發展的自然規律（生長過程），最終導致毀壞（苗枯/樹死）。"
            },
            {
                id: 23,
                category: "細節判斷",
                question: "國王對那人說「此之樹上將生美果」，「將」字暗示了什麼關鍵訊息？",
                options: [
                    "果實已經長好了",
                    "果實是將軍種的",
                    "果實現在還沒有長出來（未來式）",
                    "果實將要掉下來了"
                ],
                answer: 2, // C
                explanation: "「將生」表示將來會長出，現在還沒有。那人不等它長出來就砍樹，是沒看懂時間點。"
            },
            {
                id: 24,
                category: "文法結構",
                question: "「望得其果」的「望」，詞性是？",
                options: [
                    "名詞，希望",
                    "動詞，盼望、希圖",
                    "介詞，向",
                    "形容詞，有聲望的"
                ],
                answer: 1, // B
                explanation: "動詞，希望、企圖得到。"
            },
            {
                id: 25,
                category: "邏輯判斷",
                question: "那人「斷樹」的行為，在邏輯上犯了什麼錯誤？",
                options: [
                    "倒果為因",
                    "以偏概全",
                    "手段與目的背道而馳（斷絕了達成目的的必要條件）",
                    "循環論證"
                ],
                answer: 2, // C
                explanation: "他的目的是「取果」，但手段是「斷樹」（毀壞果實生長的來源），手段直接導致目的無法達成。"
            }
        ];

        // --- State Management ---
        let currentState = {
            username: '',
            questionIndex: 0,
            answers: {}, // { questionId: selectedOptionIndex }
            mistakes: [], // array of question IDs
            favorites: [], // array of question IDs
            isFinished: false
        };

        // --- DOM Elements ---
        const views = {
            login: document.getElementById('view-login'),
            dashboard: document.getElementById('view-dashboard'),
            quiz: document.getElementById('view-quiz'),
            result: document.getElementById('view-result'),
            review: document.getElementById('view-review')
        };
        
        const ui = {
            usernameInput: document.getElementById('username'),
            userDisplay: document.getElementById('user-display'),
            usernameSpan: document.getElementById('username-span'),
            dashboardUsername: document.getElementById('dashboard-username'),
            dashWrongCount: document.getElementById('dash-wrong-count'),
            dashFavCount: document.getElementById('dash-fav-count'),
            quickLoginArea: document.getElementById('quick-login-area'),
            recentUsersList: document.getElementById('recent-users-list'),
            currentQNum: document.getElementById('current-question-num'),
            progressBarFill: document.getElementById('progress-bar-fill'),
            btnFavorite: document.getElementById('btn-favorite'),
            questionCard: document.getElementById('question-card'),
            qCategory: document.getElementById('q-category'),
            qText: document.getElementById('q-text'),
            optionsContainer: document.getElementById('options-container'),
            explanationArea: document.getElementById('explanation-area'),
            feedbackIcon: document.getElementById('feedback-icon'),
            feedbackTitle: document.getElementById('feedback-title'),
            feedbackText: document.getElementById('feedback-text'),
            resultScore: document.getElementById('result-score'),
            resultCorrect: document.getElementById('result-correct'),
            resultWrong: document.getElementById('result-wrong'),
            reviewList: document.getElementById('review-list'),
            reviewTitle: document.getElementById('review-title')
        };

        // --- Storage Helpers ---
        function getStorageKey(type, username) {
            if (username) return DB_PREFIX + type + '-' + username;
            return DB_PREFIX + type; 
        }

        // --- Initialization ---
        function init() {
            renderRecentUsers();
        }

        function renderRecentUsers() {
            const users = JSON.parse(localStorage.getItem(getStorageKey('users')) || '[]');
            
            if (users.length > 0) {
                ui.quickLoginArea.classList.remove('hidden');
                ui.recentUsersList.innerHTML = '';
                users.forEach(user => {
                    const btn = document.createElement('button');
                    btn.className = 'px-3 py-1.5 bg-orange-50 hover:bg-orange-100 text-orange-700 rounded-full text-sm border border-orange-200 transition';
                    btn.innerHTML = `<i class="fas fa-user-circle mr-1"></i>${user}`;
                    btn.onclick = () => quickLogin(user);
                    ui.recentUsersList.appendChild(btn);
                });
            } else {
                ui.quickLoginArea.classList.add('hidden');
            }
        }

        // --- Login & Navigation ---
        function quickLogin(name) {
            ui.usernameInput.value = name;
            attemptLogin();
        }

        function attemptLogin() {
            const name = ui.usernameInput.value.trim();
            if (!name) {
                alert('請輸入姓名');
                return;
            }
            
            currentState.username = name;
            
            // Update known users list
            let users = JSON.parse(localStorage.getItem(getStorageKey('users')) || '[]');
            if (!users.includes(name)) {
                users.unshift(name); // Add to front
                if (users.length > 5) users.pop(); // Keep max 5
                localStorage.setItem(getStorageKey('users'), JSON.stringify(users));
            }

            // UI Update Header
            ui.userDisplay.classList.remove('hidden');
            ui.userDisplay.classList.add('flex');
            ui.usernameSpan.textContent = name;
            
            // Load Persistent Data for Dashboard Counts
            loadUserPersistentData(name);
            
            // Update Dashboard UI
            ui.dashboardUsername.textContent = name;
            ui.dashWrongCount.textContent = currentState.mistakes.length;
            ui.dashFavCount.textContent = currentState.favorites.length;
            
            // Go to Dashboard
            switchView('dashboard');
        }

        function switchView(viewName) {
            Object.values(views).forEach(el => el.classList.add('hidden'));
            views[viewName].classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function startExam() {
             // Check Session Progress
            const savedProgress = JSON.parse(localStorage.getItem(getStorageKey('progress', currentState.username)));
            if (savedProgress && !savedProgress.isFinished) {
                const resume = confirm(`系統發現您上次作答到第 ${savedProgress.questionIndex + 1} 題，是否繼續？`);
                if (resume) {
                    currentState.questionIndex = savedProgress.questionIndex;
                    currentState.answers = savedProgress.answers || {};
                    currentState.isFinished = false;
                    switchView('quiz');
                    loadQuestion(currentState.questionIndex);
                    return;
                }
            }
            
            // Start New Session
            restartQuiz();
        }

        function showDashboard() {
            // Update counts before showing
            ui.dashWrongCount.textContent = currentState.mistakes.length;
            ui.dashFavCount.textContent = currentState.favorites.length;
            switchView('dashboard');
        }

        function loadUserPersistentData(name) {
            const storedFavs = JSON.parse(localStorage.getItem(getStorageKey('favorites', name)) || '[]');
            currentState.favorites = storedFavs;

            const storedMistakes = JSON.parse(localStorage.getItem(getStorageKey('mistakes', name)) || '[]');
            currentState.mistakes = storedMistakes;
        }

        function resetQuizState() {
            currentState.questionIndex = 0;
            currentState.answers = {};
            currentState.isFinished = false;
            saveProgress(); 
        }

        function saveProgress() {
            const data = {
                questionIndex: currentState.questionIndex,
                answers: currentState.answers,
                isFinished: currentState.isFinished,
                timestamp: new Date().getTime()
            };
            localStorage.setItem(getStorageKey('progress', currentState.username), JSON.stringify(data));
        }

        function savePersistentData() {
            if(!currentState.username) return;
            localStorage.setItem(getStorageKey('favorites', currentState.username), JSON.stringify(currentState.favorites));
            localStorage.setItem(getStorageKey('mistakes', currentState.username), JSON.stringify(currentState.mistakes));
        }

        function logout() {
            if (confirm("確定要登出嗎？您的作答進度與錯題本已保存。")) {
                currentState.username = '';
                ui.userDisplay.classList.add('hidden');
                ui.userDisplay.classList.remove('flex');
                ui.usernameInput.value = '';
                renderRecentUsers();
                switchView('login');
            }
        }
        
        function goHome() {
            if (currentState.username) {
               showDashboard();
            } else {
                switchView('login');
            }
        }
        
        function backToHomeOrResult() {
            showDashboard();
        }

        // --- Quiz Logic ---
        function loadQuestion(index) {
            const q = questionsData[index];
            ui.currentQNum.textContent = index + 1;
            ui.qCategory.textContent = q.category;
            ui.qText.textContent = q.question;
            
            // Progress Bar
            const percent = ((index) / questionsData.length) * 100;
            ui.progressBarFill.style.width = `${Math.max(5, percent)}%`;

            // Update Favorite Icon
            updateFavoriteIcon(q.id);

            // Reset Card Style
            ui.questionCard.className = "card-neutral rounded-2xl shadow-lg overflow-hidden mb-6 border transition-colors-slow";

            // Reset Options
            ui.optionsContainer.innerHTML = '';
            
            // Check if already answered (when resuming)
            const answeredIdx = currentState.answers[q.id];
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = `option-btn w-full text-left p-4 rounded-xl border-2 border-orange-100 hover:border-orange-300 hover:bg-orange-50 transition duration-200 bg-white group flex items-center`;
                
                const letter = ['A','B','C','D'][idx];
                
                // Increased font size for options here: text-xl
                btn.innerHTML = `
                    <span class="w-8 h-8 flex items-center justify-center rounded-full bg-orange-100 text-orange-600 font-bold mr-4 group-hover:bg-orange-500 group-hover:text-white transition-colors">${letter}</span>
                    <span class="text-gray-700 font-medium text-xl">${opt}</span>
                `;
                
                btn.onclick = () => handleAnswer(index, idx, btn);
                ui.optionsContainer.appendChild(btn);
            });

            // Hide explanation
            ui.explanationArea.classList.add('hidden');
            
            // If already answered, restore visual state
            if (answeredIdx !== undefined) {
                const isCorrect = answeredIdx === q.answer;
                
                // Set Card Color
                ui.questionCard.className = isCorrect 
                    ? "card-correct rounded-2xl shadow-lg overflow-hidden mb-6 border transition-colors-slow"
                    : "card-wrong rounded-2xl shadow-lg overflow-hidden mb-6 border transition-colors-slow";

                const buttons = ui.optionsContainer.querySelectorAll('button');
                buttons.forEach((b, i) => {
                    b.disabled = true;
                    if (i === answeredIdx) {
                        if (i === q.answer) {
                            b.classList.remove('bg-white', 'border-orange-100');
                            b.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                            b.querySelector('span').classList.add('bg-green-500', 'text-white');
                        } else {
                            b.classList.remove('bg-white', 'border-orange-100');
                            b.classList.add('bg-red-50', 'border-red-500', 'text-red-800');
                            b.querySelector('span').classList.add('bg-red-500', 'text-white');
                        }
                    } else if (i === q.answer) {
                        b.classList.remove('bg-white', 'border-orange-100');
                        b.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                        b.querySelector('span').classList.add('bg-green-500', 'text-white');
                    }
                });
                
                // Show explanation
                ui.feedbackIcon.className = isCorrect ? "fas fa-check-circle text-green-500 text-2xl" : "fas fa-times-circle text-red-500 text-2xl";
                ui.feedbackTitle.textContent = isCorrect ? "答對了！" : "答錯了！";
                ui.feedbackTitle.className = isCorrect ? "text-lg font-bold text-green-700 mb-2" : "text-lg font-bold text-red-700 mb-2";
                ui.feedbackText.textContent = q.explanation;
                ui.explanationArea.classList.remove('hidden');
            }
        }

        function handleAnswer(qIndex, selectedIdx, btnElement) {
            // Disable all buttons
            const buttons = ui.optionsContainer.querySelectorAll('button');
            buttons.forEach(b => b.disabled = true);

            const q = questionsData[qIndex];
            const isCorrect = selectedIdx === q.answer;
            const letterSpan = btnElement.querySelector('span');
            
            // Card Color Feedback
            ui.questionCard.className = isCorrect 
                ? "card-correct rounded-2xl shadow-lg overflow-hidden mb-6 border transition-colors-slow"
                : "card-wrong rounded-2xl shadow-lg overflow-hidden mb-6 border transition-colors-slow";

            // Style selection
            if (isCorrect) {
                btnElement.classList.remove('bg-white', 'border-orange-100');
                btnElement.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                letterSpan.classList.remove('bg-orange-100', 'text-orange-600');
                letterSpan.classList.add('bg-green-500', 'text-white');
                
                ui.feedbackIcon.className = "fas fa-check-circle text-green-500 text-2xl";
                ui.feedbackTitle.textContent = "答對了！";
                ui.feedbackTitle.className = "text-lg font-bold text-green-700 mb-2";
            } else {
                btnElement.classList.remove('bg-white', 'border-orange-100');
                btnElement.classList.add('bg-red-50', 'border-red-500', 'text-red-800');
                letterSpan.classList.remove('bg-orange-100', 'text-orange-600');
                letterSpan.classList.add('bg-red-500', 'text-white');
                
                // Highlight correct answer
                const correctBtn = buttons[q.answer];
                correctBtn.classList.remove('bg-white', 'border-orange-100');
                correctBtn.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                correctBtn.querySelector('span').classList.add('bg-green-500', 'text-white');

                ui.feedbackIcon.className = "fas fa-times-circle text-red-500 text-2xl";
                ui.feedbackTitle.textContent = "答錯了！";
                ui.feedbackTitle.className = "text-lg font-bold text-red-700 mb-2";
                
                // Record mistake persistently
                if (!currentState.mistakes.includes(q.id)) {
                    currentState.mistakes.push(q.id);
                    savePersistentData();
                }
            }

            // Save state
            currentState.answers[q.id] = selectedIdx;
            saveProgress();

            // Show explanation
            ui.feedbackText.textContent = q.explanation;
            ui.explanationArea.classList.remove('hidden');
            
            // Scroll to explanation
            ui.explanationArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            currentState.questionIndex++;
            saveProgress(); 
            
            if (currentState.questionIndex < questionsData.length) {
                loadQuestion(currentState.questionIndex);
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            currentState.isFinished = true;
            saveProgress();
            
            // Calculate Score (Session only)
            let correctCount = 0;
            questionsData.forEach(q => {
                if (currentState.answers[q.id] === q.answer) {
                    correctCount++;
                }
            });
            const score = Math.round((correctCount / questionsData.length) * 100);
            
            // Update UI
            ui.resultScore.textContent = score;
            ui.resultCorrect.textContent = correctCount;
            ui.resultWrong.textContent = questionsData.length - correctCount;
            
            switchView('result');
        }

        function restartQuiz() {
            resetQuizState();
            switchView('quiz');
            loadQuestion(0);
        }

        // --- Favorites Logic ---
        function toggleFavorite() {
            const currentQ = questionsData[currentState.questionIndex];
            const id = currentQ.id;
            
            const index = currentState.favorites.indexOf(id);
            if (index === -1) {
                currentState.favorites.push(id);
            } else {
                currentState.favorites.splice(index, 1);
            }
            
            // Persist favorites
            savePersistentData();
            
            updateFavoriteIcon(id);
        }

        function updateFavoriteIcon(id) {
            const icon = ui.btnFavorite.querySelector('i');
            if (currentState.favorites.includes(id)) {
                icon.className = "fas fa-star text-2xl text-amber-500";
                ui.btnFavorite.classList.add('text-amber-500');
                ui.btnFavorite.classList.remove('text-gray-300');
            } else {
                icon.className = "far fa-star text-2xl";
                ui.btnFavorite.classList.remove('text-amber-500');
                ui.btnFavorite.classList.add('text-gray-300');
            }
        }

        // --- Review & All Questions Logic ---
        function showReview(type) {
            const ids = type === 'wrong' ? currentState.mistakes : currentState.favorites;
            ui.reviewTitle.textContent = type === 'wrong' ? '錯題本 (歷史累計)' : '我的最愛';
            
            renderQuestionList(ids, true);
            switchView('review');
        }

        function showAllQuestions() {
            ui.reviewTitle.textContent = '題目一覽表';
            const allIds = questionsData.map(q => q.id);
            renderQuestionList(allIds, false);
            switchView('review');
        }

        function renderQuestionList(ids, showUserStatus) {
            ui.reviewList.innerHTML = '';
            
            if (ids.length === 0) {
                ui.reviewList.innerHTML = `
                    <div class="text-center py-10 bg-white rounded-xl shadow-sm border border-orange-100">
                        <i class="far fa-folder-open text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">目前沒有紀錄。</p>
                    </div>`;
                return;
            }

            ids.forEach(id => {
                const q = questionsData.find(item => item.id === id);
                if (!q) return;

                const item = document.createElement('div');
                item.className = 'bg-white p-6 rounded-xl shadow-sm border border-orange-100 hover:shadow-md transition';
                
                const optionsHtml = q.options.map((opt, idx) => {
                    const isCorrect = idx === q.answer;
                    
                    let userSelectedIdx = -1;
                    if (showUserStatus) {
                         userSelectedIdx = currentState.answers[q.id];
                    }
                    const isUserSelected = userSelectedIdx === idx;
                    
                    let classStr = "ml-3 p-3 rounded-lg border flex items-center ";
                    let icon = "";
                    
                    if (isCorrect) {
                        classStr += "bg-green-100 border-green-300 text-green-900 font-bold";
                        icon = '<i class="fas fa-check text-green-700 mr-2"></i>';
                    } else if (isUserSelected && !isCorrect) {
                        classStr += "bg-red-50 border-red-200 text-red-800 line-through opacity-75";
                        icon = '<i class="fas fa-times text-red-600 mr-2"></i>';
                    } else {
                        classStr += "border-transparent text-gray-500";
                        icon = '<span class="w-6 inline-block"></span>';
                    }
                    
                    // Increased font size for review options: text-lg
                    return `<div class="${classStr} text-lg">${icon} ${['A','B','C','D'][idx]}. ${opt}</div>`;
                }).join('');

                item.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-md font-bold">${q.category}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-gray-300 text-xs">#${q.id}</span>
                        </div>
                    </div>
                    <p class="font-bold text-lg mb-4 text-gray-800">${q.question}</p>
                    <div class="space-y-2 mb-4 text-sm">
                        ${optionsHtml}
                    </div>
                    <!-- Increased font size for review explanation: text-lg -->
                    <div class="bg-amber-50 p-4 rounded-lg text-lg text-gray-700 border border-amber-100 leading-relaxed">
                        <span class="font-bold text-orange-600"><i class="fas fa-lightbulb mr-1"></i>解析：</span> ${q.explanation}
                    </div>
                `;
                ui.reviewList.appendChild(item);
            });
        }

        function backToResult() {
            switchView('result');
        }

        function clearData() {
            if(confirm("警告：這將會清除「這台裝置」上所有使用者的作答紀錄、錯題本與最愛清單，且無法復原。\n\n確定要執行嗎？")) {
                Object.keys(localStorage).forEach(key => {
                    if(key.startsWith(DB_PREFIX)) localStorage.removeItem(key);
                });
                location.reload();
            }
        }

        // Start
        init();

    </script>
</body>
</html>